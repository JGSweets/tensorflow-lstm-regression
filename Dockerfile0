# base.docker
FROM ubuntu:trusty

RUN echo "deb http://ppa.launchpad.net/pypy/ppa/ubuntu trusty main" > \
    /etc/apt/sources.list.d/pypy-ppa.list

RUN apt-key adv --keyserver keyserver.ubuntu.com \
                --recv-keys 2862D0785AFACD8C65B23DB0251104D968854915
RUN apt-get update

RUN apt-get install -qyy \
    -o APT::Install-Recommends=false -o APT::Install-Suggests=false \
    make automake gcc gfortran \
    python-virtualenv pypy libffi6 openssl

RUN apt-get upgrade --yes --force-yes gcc
RUN apt-get install --yes --force-yes python-dev python2.7-dev python-numpy

RUN virtualenv -p /usr/bin/pypy /appenv
RUN . /appenv/bin/activate; pip install pip==8.1.2
RUN . /appenv/bin/activate; pip install --upgrade pip

RUN mkdir /etc/pki
RUN mkdir /etc/pki/tls
RUN mkdir /etc/pki/tls/certs
RUN apt-get install -qyy wget
RUN wget http://curl.haxx.se/ca/cacert.pem
RUN mv cacert.pem ca-bundle.crt
RUN mv ca-bundle.crt /etc/pki/tls/certs

ADD . /opt/app
WORKDIR /opt/app


ENV C_INCLUDE_PATH /usr/include/python2.7:$C_INCLUDE_PATH

RUN . /appenv/bin/activate; pip install numpy==1.7.1



EXPOSE 8888
